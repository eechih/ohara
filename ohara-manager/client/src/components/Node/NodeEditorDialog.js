/*
 * Copyright 2019 is-land
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import React from 'react';
import PropTypes from 'prop-types';
import { Form, Field } from 'react-final-form';

import { InputField } from 'components/common/Form';
import { Dialog } from 'components/common/Dialog';
import {
  required,
  minNumber,
  maxNumber,
  composeValidators,
} from 'utils/validate';

const parsePort = (value) => (isNaN(parseInt(value)) ? '' : parseInt(value));

const NodeEditorDialog = ({ isOpen, node, onClose, onConfirm }) => {
  return (
    <Form
      initialValues={{}}
      onSubmit={onConfirm}
      render={({ handleSubmit, form, submitting, pristine, invalid }) => {
        return (
          <Dialog
            confirmDisabled={submitting || pristine || invalid}
            confirmText="SAVE"
            onClose={() => {
              onClose();
              form.reset();
            }}
            onConfirm={handleSubmit}
            open={isOpen}
            title="Edit node"
          >
            <form onSubmit={handleSubmit}>
              <Field
                component={InputField}
                defaultValue={node?.hostname}
                disabled
                helperText="hostname of the node"
                id="hostname"
                label="Hostname"
                margin="normal"
                name="hostname"
                placeholder="node-01"
                type="text"
              />
              <Field
                component={InputField}
                defaultValue={node?.port}
                helperText="SSH port of the node"
                id="port"
                inputProps={{
                  min: 1,
                  max: 65535,
                }}
                label="Port"
                margin="normal"
                name="port"
                parse={parsePort}
                placeholder="22"
                type="number"
                validate={composeValidators(
                  required,
                  minNumber(1),
                  maxNumber(65535),
                )}
              />
              <Field
                component={InputField}
                defaultValue={node?.user}
                fullWidth
                helperText="SSH username"
                id="user"
                label="User"
                margin="normal"
                name="user"
                placeholder="admin"
                validate={required}
              />
              <Field
                component={InputField}
                defaultValue={node?.password}
                fullWidth
                helperText="SSH password"
                id="password"
                label="Password"
                margin="normal"
                name="password"
                placeholder="password"
                type="password"
                validate={required}
              />
            </form>
          </Dialog>
        );
      }}
    />
  );
};

NodeEditorDialog.propTypes = {
  isOpen: PropTypes.bool.isRequired,
  node: PropTypes.shape({
    hostname: PropTypes.string,
    port: PropTypes.number,
    user: PropTypes.string,
    password: PropTypes.string,
  }),
  onClose: PropTypes.func,
  onConfirm: PropTypes.func.isRequired,
};

NodeEditorDialog.defaultProps = {
  node: null,
  onClose: () => {},
};

export default NodeEditorDialog;
